<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Osiyo HR</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <style>
        /*.step-box {
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .step-box.active {
            display: block;
        }

        .step-box.hidden {
            display: none;
        }*/

        body {
            background-color: white;
            color: black;
            padding-top: 20px;
        }

        .logo-text-container {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo-text-container img {
            width: 100px;
            height: auto;
            vertical-align: middle;
            margin-right: 10px;
        }
    </style>
</head>

<body>

<div class="container">
    <div class="logo-text-container">
        <img src="logo_osiyo.png" alt="Logo"/>
        <!-- <h1>Osiyo HR</h1> -->
    </div>
    <form id="multiStepForm" form="form">
        <!-- Personal info - START -->
        <div class="step-box active" id="step1">
            <h2>Shaxsiy ma'lumot :</h2>
            <div class="mb-3">
                <label for="inputFirstName" class="form-label">FIO:</label>
                <input type="text" class="form-control" id="inputFirstName" placeholder="Familiya Ism Otangizni ismi"
                       required/>
            </div>
            <div class="mb-3">
                <label for="inputBirthDate" class="form-label">Tug'ulgan sanangiz:</label
                >
                <input
                        type="date"
                        class="form-control"
                        id="inputBirthDate"
                        required
                />
            </div>
            <div class="mb-3">
                <label for="inputLocation" class="form-label">Manzilingiz:</label>
                <input type="text" class="form-control" id="inputLocation" placeholder="Shahar, ko'cha, uy, xonadon "
                       required/>
            </div>
            <!-- <div class="mb-3">
                <label for="userImage" class="form-label">Rasmingizni yuklang:</label>
                <div class="input-group">
                    <input type="file" class="form-control" id="userImage" accept=".jpg, .jpeg, .png" required>
                    <div class="input-group-append">
                    </div>
                </div>
            </div> -->
            <div class="mb-3">
                <label for="inputPhoneNum" class="form-label">Tel:</label>
                <div class="input-group">
                    <span class="input-group-text">+998</span>
                    <input type="tel" class="form-control" id="inputPhoneNum" maxlength="12"
                           pattern="[0-9]{2} [0-9]{3} [0-9]{2} [0-9]{2}" placeholder="99 999 99 99" required/>
                </div>
                <div class="invalid-feedback">
                    Iltimos telifon raqamingizni to'gri kiriting (99 999 99 99).
                </div>
            </div>
            <button class="btn btn-primary next-btn w-100" data-step="step2" type="button">Oldinga</button>
        </div>
        <!-- Personal info - END -->

        <!-- Education - START -->
        <div class="step-box hidden" id="step2">
            <h2>Ma'lumotingiz</h2>
            <div class="mb-3">
                <label for="inputSelectEducation" class="form-label">Ma'lumotingiz:</label
                >
                <select name="education" id="inputSelectEducation" class="form-control">
                    <option value="O'rta">O'rta (maktab)</option>
                    <option value="O'rta-maxsus (litsey | kollej)" selected>O'rta-maxsus (litsey | kollej)</option>
                    <option value="Oliy (bakalavr)">Oliy (bakalavr)</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="inputIsStudying" class="form-label"
                >Hozir ham o'qishingiz:</label
                >
                <select
                        name="isStudying"
                        id="inputIsStudying"
                        class="form-control"
                        onchange="toggleTimeInputs()"
                >
                    <option value="ha" selected>Ha</option>
                    <option value="yo'q">Yo'q</option>
                </select>
            </div>
            <div id="timeInputs" class="mb-3" style="display: block">
                <label for="startTime2" class="form-label">Boshlanish vaqti:</label>
                <input type="time" id="startTime2" class="form-control" name="startTime" required/>
                <label for="endTime2" class="form-label">Tugash vaqti:</label>
                <input type="time" id="endTime2" class="form-control" name="endTime" required/>
            </div>
            <div class="btn-group w-100" role="group" aria-label="Step buttons">
                <button class="btn btn-primary prev-btn mr-3" data-step="step1">Ortga</button>
                <button class="btn btn-primary next-btn" data-step="step3" type="button">Oldinga</button>
            </div>


        </div>
        <!-- Education - END -->

        <!-- Work exp - START -->
        <div class="step-box hidden" id="step3">
            <h2>Ish tajribasi</h2>
            <div class="mb-3">
                <label for="inputLastJobTime" class="form-label">Ish tajribangizni kiriting:</label
                >
                <select
                        name="education"
                        id="inputLastJobTime"
                        class="form-control"
                        onchange="togglePractice()"
                        required
                >
                    <option value="exp_yo'q">Yo'q</option>
                    <option value="exp_1" selected>0-1 yil</option>
                    <option value="exp_2-5">2-5 yil</option>
                    <option value="exp_5">5 yildan ortiq</option>
                </select>
            </div>
            <div id="lastJobInfo" class="mb-3" style="display: block">
                <div class="mb-3">
                    <label for="inputComp" class="form-label"
                    >Oldingi ishingizdagi korxona nomi:</label
                    >
                    <input
                            type="text"
                            class="form-control"
                            id="inputComp"
                            placeholder="MCHJ"
                            required
                    />
                </div>
                <div class="mb-3">
                    <label for="inputLastJob" class="form-label"
                    >Kim bo'lib ishlaganingiz:</label
                    >
                    <input
                            type="text"
                            class="form-control"
                            id="inputLastJob"
                            placeholder="Ish bochqaruvchi"
                            required
                    />
                </div>
                <div class="mb-3">
                    <label for="inputReason" class="form-label"
                    >Bizga qiziqish bildirishingizning sababi:</label
                    >
                    <textarea
                            type="text"
                            class="form-control"
                            id="inputReason"
                            placeholder=""
                            required
                    ></textarea>
                </div>
            </div>

            <div class="btn-group w-100" role="group" aria-label="Step buttons">
                <button class="btn btn-primary prev-btn mr-3" data-step="step2">Ortga</button>
                <button class="btn btn-primary next-btn" data-step="step4" type="button">Oldinga</button>
            </div>
        </div>
        <!-- Work exp - END -->

        <!-- Laguage knowledges - START -->
        <div class="step-box hidden" id="step4">
            <h2>Til bilish qobiliyatlari</h2>
            <div id="selectedLanguages">
                <div class="row align-items-center language-row mb-3">
                    <div class="col-md-6">
                        <div class="form-group">
                            <input type="text" class="form-control language-name" id="language_0" placeholder="Til"
                                   required/>
                        </div>
                    </div>
                    <div class="col-md-6 mb-1"></div>

                    <div class="col-md-6">
                        <div class="form-group">
                            <select name="languageLevel" id="languageLevel_0" class="form-control language-level"
                                    required>
                                <option value="" disabled selected hidden>Til bilish darajangiz</option>
                                <option value="Beginner">Boshlang'ich</option>
                                <option value="Intermediate">O'rta daraja</option>
                                <option value="Advanced">Yuqori daraja</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="checkbox-group">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="readCheckbox_0" value="read">
                                <label class="form-check-label custom-checkbox" for="readCheckbox_0">O'qish</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="writeCheckbox_0" value="write">
                                <label class="form-check-label custom-checkbox" for="writeCheckbox_0">Yozish</label>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="checkbox-group">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="speakCheckbox_0" value="speak">
                                <label class="form-check-label" for="speakCheckbox_0">Gaplashish</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-12 d-grid mb-1">
                <button class="btn btn-success btn-sm add-language-btn" id="addLanguageBtn" type="button">Tilni
                    qo'shish
                </button>
            </div>
            <div class="btn-group w-100" role="group" aria-label="Step buttons">
                <button class="btn btn-primary prev-btn mr-3" data-step="step3">Ortga</button>
                <button class="btn btn-primary next-btn" data-step="step5" type="button">Oldinga</button>
            </div>
        </div>
        <!-- Laguage knowledges - END -->

        <!-- New work - START -->
        <div class="step-box hidden" id="step6">
            <h2>Sizning xohishingiz</h2>
            <div class="mb-3">
                <label for="inputNewJob" class="form-label"
                >Qaysi lavozimda ishlamoqchiligingizni kiriting:</label
                >
                <input
                        type="text"
                        class="form-control"
                        id="inputNewJob"
                        placeholder=""
                        required
                />
            </div>

            <div class="mb-3">
                <label class="form-label">Oylik maosh:</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="minPrice" placeholder="Minimum" aria-label="Minimum"
                           required/>
                    <span class="input-group-text">-</span>
                    <input type="text" class="form-control" id="maxPrice" placeholder="Maksimum" aria-label="Maksimum"
                           required/>
                </div>
            </div>
            <div class="btn-group w-100" role="group" aria-label="Step buttons">
                <button class="btn btn-primary prev-btn mr-3" data-step="step3">Ortga</button>
                <button class="btn btn-primary" data-step="step6" id="submit">Tasdiqlash</button>
            </div>
        </div>
        <!-- New work - END -->
    </form>
</div>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
    let tg = window.Telegram.WebApp;
    tg.expand();
    document.addEventListener("DOMContentLoaded", function () {
        let form = document.getElementById("multiStepForm");
        let steps = form.querySelectorAll(".step-box");
        let nextBtns = form.querySelectorAll(".next-btn");
        let prevBtns = form.querySelectorAll(".prev-btn");
        let addLanguageBtn = document.getElementById("addLanguageBtn");
        let selectedLanguages = document.getElementById('selectedLanguages');
        let languageCount = 1;

        nextBtns.forEach(function (btn) {
            btn.addEventListener("click", function (e) {
                e.preventDefault();
                const currentStep = btn.closest(".step-box");
                const nextStepId = btn.dataset.step;
                const nextStep = form.querySelector("#" + nextStepId);
                if (validateStep(currentStep)) {
                    currentStep.classList.remove("active");
                    currentStep.classList.add("hidden");
                    nextStep.classList.remove("hidden");
                    nextStep.classList.add("active");
                }
            });
        });

        prevBtns.forEach(function (btn) {
            btn.addEventListener("click", function (e) {
                e.preventDefault();
                const currentStep = btn.closest(".step-box");
                const prevStepId = btn.dataset.step;
                const prevStep = form.querySelector("#" + prevStepId);
                currentStep.classList.remove("active");
                currentStep.classList.add("hidden");
                prevStep.classList.remove("hidden");
                prevStep.classList.add("active");
            });
        });

    //     addLanguageBtn.addEventListener("click", function () {
    //         console.log('added language');
    //         if (languageCount < 4) {
    //             let languageRowHTML = `
    //             <div class="row align-items-center language-row mb-3 ">
    //                 <div class="col-md-6 ">
    //                     <div class="form-group ">
    //                         <input type="text" class="form-control language-name " id="language_${languageCount} " placeholder="Til " required />
    //                     </div>
    //                 </div>
    //                 <div class="col-md-6 mb-1 "></div>
    //                 <div class="col-md-6 ">
    //                     <div class="form-group ">
    //                         <select name="languageLevel " id="languageLevel_${languageCount}" class="form-control language-level " required>
    //                                 <option value=" " disabled selected hidden>Til bilish darajangiz</option>
    //                                 <option value="Beginner ">Boshlang'ich</option>
    //                                 <option value="Intermediate ">O'rta daraja</option>
    //                                 <option value="Advanced ">Yuqori daraja</option>
    //                         </select>
    //                     </div>
    //                 </div>
    //                 <div class="col-md-6 ">
    //                     <div class="checkbox-group ">
    //                         <div class="form-check ">
    //                             <input type="checkbox" class="form-check-input " id="readCheckbox_${languageCount} " value="read ">
    //                             <label class="form-check-label custom-checkbox " for="readCheckbox_${languageCount} ">O'qish</label>
    //                         </div>
    //                         <div class="form-check ">
    //                             <input type="checkbox" class="form-check-input " id="writeCheckbox_${languageCount} " value="write ">
    //                             <label class="form-check-label custom-checkbox " for="writeCheckbox_${languageCount} ">Yozish</label>
    //                         </div>
    //                     </div>
    //                 </div>
    //                 <div class="col-md-6 ">
    //                     <div class="checkbox-group ">
    //                         <div class="form-check ">
    //                             <input class="form-check-input " type="checkbox" id="speakCheckbox_${languageCount} " value="speak ">
    //                             <label class="form-check-label " for="speakCheckbox_${languageCount} ">Gaplashish</label>
    //                         </div>
    //                     </div>
    //                 </div>
    //                 <div class="col-md-12 d-grid ">
    //                     <button class="btn btn-danger btn-sm btn-block del_la ">Tilni olib tashlash</button>
    //                 </div>
    //             </div>
    //         `;
    //             selectedLanguages.insertAdjacentHTML('beforeend', languageRowHTML);
    //             languageCount++;
    //         } else {
    //             alert("4 tildan ortiq tilni qushib bo 'lmaydi.");
    //         }
    //     });
    //
    //     selectedLanguages.addEventListener("click", function (event) {
    //         if (event.target.classList.contains("del_la")) {
    //             event.preventDefault();
    //             const languageRow = event.target.closest(".language-row");
    //             languageRow.remove();
    //             languageCount--;
    //         }
    //     });
    });

    function toggleTimeInputs() {
        let isStudyingSelect = document.getElementById("inputIsStudying");
        let timeInputsDiv = document.getElementById("timeInputs");
        let startTimeInput = document.getElementById("startTime2");
        let endTimeInput = document.getElementById("endTime2");

        if (isStudyingSelect.value === "ha") {
            timeInputsDiv.style.display = "block";
            startTimeInput.required = true;
            endTimeInput.required = true;
        } else {
            timeInputsDiv.style.display = "none";
            startTimeInput.required = false;
            endTimeInput.required = false;
        }
    }

    function togglePractice() {
        let practice = document.getElementById("inputLastJobTime");
        let lastJobInfo = document.getElementById("lastJobInfo");
        let lastJob = document.getElementById("inputLastJob");
        let comp = document.getElementById("inputComp");
        let reason = document.getElementById("inputReason");

        if (practice.value === "exp_yo'q") {
            lastJobInfo.style.display = "none";
            lastJob.required = false;
            lastJobInfo.required = false;
            comp.required = false;
            reason.required = false;
        } else {
            lastJobInfo.style.display = "block";
            lastJob.required = true;
            lastJobInfo.required = true;
            comp.required = true;
            reason.required = true;
        }
    }

    function gatherLanguageData() {
        const languageData = [];

        const languageRows = document.querySelectorAll(".language-row");

        languageRows.forEach(function (row, index) {
            const languageName = row.querySelector(`#language_${index}`).value;
            const languageLevel = row.querySelector(`#languageLevel_${index}`).value;

            const readCheckbox = row.querySelector(`#readCheckbox_${index}`);
            const writeCheckbox = row.querySelector(`#writeCheckbox_${index}`);
            const speakCheckbox = row.querySelector(`#speakCheckbox_${index}`);

            const languageSkills = [];

            if (readCheckbox.checked) {
                languageSkills.push("Reading");
            }
            if (writeCheckbox.checked) {
                languageSkills.push("Writing");
            }
            if (speakCheckbox.checked) {
                languageSkills.push("Speaking");
            }

            languageData.push({
                name: languageName,
                level: languageLevel,
                skills: languageSkills
            });
        });

        return languageData;
    }

    function validateStep(step) {
        const inputs = step.querySelectorAll("input, select, textarea");
        let isValid = true;

        inputs.forEach(function (input) {
            if (input.required && !input.value.trim()) {
                isValid = false;
                input.classList.add("is-invalid");
            } else {
                input.classList.remove("is-invalid");
            }
        });
        const inputIsStudying = document.getElementById("inputIsStudying");
        if (inputIsStudying.required && inputIsStudying.value === "") {
            inputIsStudying.classList.add("is-invalid");
            isValid = false;
        } else {
            inputIsStudying.classList.remove("is-invalid");
        }
        return isValid;
    }

    const inputPhoneNum = document.getElementById("inputPhoneNum");

    inputPhoneNum.addEventListener("input", function (event) {
        const phoneNumPattern = /^[0-9]{9}$/;
        const phoneNumber = inputPhoneNum.value;

        if (!phoneNumPattern.test(phoneNumber) && phoneNumber.length === 9) {
            inputPhoneNum.classList.add("is-invalid");
        } else {
            inputPhoneNum.classList.remove("is-invalid");
        }
    });

    inputPhoneNum.addEventListener("input", function (event) {
        let phoneNumber = inputPhoneNum.value.replace(/\D/g, "");

        if (phoneNumber.length < 2) {
            inputPhoneNum.value = phoneNumber;
            return;
        }

        phoneNumber = phoneNumber.replace(
            /(\d{2})(\d{3})(\d{2})(\d{2})/,
            "$1 $2 $3 $4"
        );

        inputPhoneNum.value = phoneNumber;
    });


    let submit = document.getElementById("submit");

    submit.addEventListener("click", () => {
        console.log('submitted')
        let fullname = document.getElementById("inputFirstName").value;
        let birthDate = document.getElementById("inputBirthDate").value;
        let location = document.getElementById("inputLocation").value;
        let phone = document.getElementById("inputPhoneNum").value;
        let education = document.getElementById("inputSelectEducation").value;
        let isStudying = document.getElementById("inputIsStudying").value;
        let startTime = document.getElementById("startTime2").value;
        let endTime = document.getElementById("endTime2").value;
        let experience = document.getElementById("inputLastJobTime").value;
        let company = document.getElementById("inputComp").value;
        let lastJob = document.getElementById("inputLastJob").value;
        let reason = document.getElementById("inputReason").value;
        let newJob = document.getElementById("inputNewJob").value;
        let minPrice = document.getElementById("minPrice").value;
        let maxPrice = document.getElementById("maxPrice").value;
        let languages = gatherLanguageData();


        let data = {
            fullname: fullname,
            birthDate: birthDate,
            location: location,
            phone: phone,
            education: education,
            isStudying: isStudying,
            startTime: startTime,
            endTime: endTime,
            experience: experience,
            company: company,
            lastJob: lastJob,
            reason: reason,
            newJob: newJob,
            minPrice: minPrice,
            maxPrice: maxPrice,
            languages: languages
        };

        tg.sendData(JSON.stringify(data));
        // tg.sendData(data);
        window.close();
    })
</script>
</body>

</html>
